<!DOCTYPE html>
<html lang="zh-CN">

<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>Ae1autumn</title>
   <link rel="icon" href="https://avatars.githubusercontent.com/u/195545824?v=4" as="style" onload="this.onload=null;this.rel='stylesheet'">
   <noscript>
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
   </noscript>
   <style>
      :root {
         --primary-color: #e74c3c;
         --dark-bg: #121212;
         --dark-card: #1e1e1e;
         --light-bg: #f5f7fa;
         --light-primary: #e74c3c;
         --transition-time: 0.3s;
      }
      
      .theme-transitioning * {
          transition: none !important;
      }


      * {
         margin: 0;
         padding: 0;
         box-sizing: border-box;
         font-family: system-ui, -apple-system, 'Segoe UI', Roboto, Ubuntu, Cantarell, sans-serif;
      }

      html,
      body {
         height: 100%;
         background-color: var(--dark-bg);
         color: #ffffff;
         line-height: 1.6;
         transition: background-color var(--transition-time), color var(--transition-time);
      }

      .container {
         max-width: 1200px;
         margin: 0 auto;
         padding: 13px;
         height: 100%;
      }

      .mobile-layout {
         display: flex;
         flex-direction: column;
         height: 100%;
         overflow: hidden;
         position: relative;
      }

      .mobile-top-section {
         background-color: var(--dark-card);
         border-radius: 10px;
         margin-bottom: 5px;
         box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
         transition: all 0.35s cubic-bezier(0.4, 0, 0.2, 1);
         flex-shrink: 0;
         contain: layout style;
         will-change: height, padding;
         z-index: 10;
         position: relative;
      }

      .mobile-top-section.expanded {
         padding: 10px 15px 15px;
         max-height: 265px;
      }

      .mobile-top-section.collapsed {
         padding: 10px 15px 0px;
         min-height: 50px;
      }

      .mobile-top-bar {
         display: flex;
         align-items: center;
         justify-content: space-between;
         margin-bottom: 10px;
         min-height: 40px;
      }

      .avatar {
         width: 40px;
         height: 40px;
         border-radius: 50%;
         background-color: var(--primary-color);
         display: flex;
         align-items: center;
         justify-content: center;
         color: white;
         font-size: 18px;
         flex-shrink: 0;
         will-change: transform, background-color;
         transition: transform 0.2s ease-out, background-color var(--transition-time);
         contain: layout style;
      }

      .mobile-title-container {
         flex-grow: 1;
         text-align: center;
         cursor: pointer;
         padding: 0 15px;
         display: flex;
         align-items: center;
         justify-content: center;
         min-height: 40px;
      }

      .mobile-title {
         color: white;
         font-size: 18px;
         font-weight: 600;
         transition: all var(--transition-time) ease;
      }

      .menu-btn {
         width: 36px;
         height: 36px;
         border-radius: 50%;
         background-color: transparent;
         display: flex;
         align-items: center;
         justify-content: center;
         color: white;
         font-size: 18px;
         cursor: pointer;
         flex-shrink: 0;
         border: none;
         outline: none;
         will-change: transform, background-color;
         transition: transform 0.2s ease-out, background-color var(--transition-time);
         contain: layout style;
         z-index: 1002;
         position: relative;
      }

      .mobile-top-card {
         background-color: #121212;
         border-radius: 8px;
         padding: 20px;
         box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
         transition: all 0.35s cubic-bezier(0.4, 0, 0.2, 1);
         max-height: 190px;
         overflow: hidden;
         color: white;
         will-change: max-height, opacity, transform;
         contain: layout style;
         overflow-y: auto;
         scrollbar-width: none;
         -ms-overflow-style: none;
         word-wrap: break-word;
         overflow-wrap: break-word;
         word-break: break-word;
      }

      .mobile-top-section.collapsed .mobile-top-card {
         max-height: 0;
         padding: 0;
         margin: 0;
         opacity: 0;
         transform: translateY(-10px);
      }

      .floating-menu {
         position: fixed;
         top: 60px;
         right: 0px;
         background-color: var(--dark-card);
         border-radius: 8px;
         padding: 15px;
         z-index: 10;
         visibility: hidden;
         opacity: 0;
         width: 105px;

         max-width: calc(100% - 30px);
         color: white;
         will-change: opacity, transform, visibility;
         transition: opacity 0.25s ease-out, transform 0.25s cubic-bezier(0.4, 0, 0.2, 1), visibility 0.25s;
         contain: layout style;
         transform-origin: top right;
         min-width: 0;
         transform: scale(0.9);
      }

      .floating-menu.active {
         visibility: visible;
         opacity: 1;
         transform: scale(1);
         transition: opacity 0.25s ease-out, transform 0.25s cubic-bezier(0.4, 0, 0.2, 1), visibility 0.25s;
      }

      .floating-menu.closing {
         visibility: visible;
         opacity: 0;
         transform: scale(0.9);
         transition: opacity 0.25s ease-out, transform 0.25s cubic-bezier(0.4, 0, 0.2, 1), visibility 0.25s;
      }

      .menu-items {
         margin-top: 0px;
      }

      .menu-item {
         padding: 10px 0;
         border-bottom: 1px solid #333;
         font-size: 16px;
         cursor: pointer;
         color: white;
         transition: color 0.2s ease-out, transform 0.2s ease-out;
         will-change: color, transform;
         contain: layout style;
         text-decoration: none;
         display: block;
      }

      .menu-item:hover {
         color: var(--primary-color);
         transform: translateX(5px);
      }

      .article-list-section {
         flex: 1 1 0;
         min-height: 0;
         display: flex;
         flex-direction: column;
         overflow: hidden;
         will-change: transform;
         contain: layout style;
         z-index: 1;
         position: relative;
      }

      .mobile-cards-container {
         flex: 1;
         display: flex;
         flex-direction: column;
         min-height: 0;
         overflow: hidden;
      }

      .mobile-cards-wrapper {
         flex: 1;
         display: flex;
         gap: 15px;
         padding: 10px 5px 15px;
         overflow-x: auto;
         overflow-y: hidden;
         -ms-overflow-style: none;
         scrollbar-width: none;
         will-change: transform;
         backface-visibility: hidden;
         -webkit-backface-visibility: hidden;
         transform: translateZ(0);
         -webkit-transform: translateZ(0);
         contain: layout style paint;
         z-index: 1;
      }

      .mobile-cards-wrapper::-webkit-scrollbar {
         display: none;
      }

      .mobile-card {
         min-width: 280px;
         max-width: 320px;
         background-color: var(--dark-card);
         border-radius: 10px;
         padding: 20px;
         box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
         cursor: pointer;
         transition: transform 0.2s ease-out, box-shadow 0.2s ease-out;
         display: flex;
         flex-direction: column;
         gap: 15px;
         flex-shrink: 0;
         height: auto;
         will-change: transform;
         contain: layout style;
      }

      .mobile-card:hover {
         transform: translateY(-5px);
         box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
      }

      .card-tags {
         display: flex;
         flex-wrap: wrap;
         gap: 8px;
      }

      .card-tag {
         padding: 4px 12px;
         border-radius: 15px;
         font-size: 12px;
         font-weight: 500;
         transition: all 0.2s ease-out;
         will-change: background-color, color;
      }

      .card-title {
         font-size: 20px;
         font-weight: 600;
         color: white;
         margin: 0;
         line-height: 1.4;
         transition: color var(--transition-time);
      }

      .card-description {
         font-size: 14px;
         color: #b0b0b0;
         line-height: 1.6;
         margin: 0;
         transition: color var(--transition-time);
      }

      .card-meta {
         display: flex;
         justify-content: space-between;
         align-items: center;
         font-size: 13px;
         color: #888;
         margin-top: auto;
         padding-top: 10px;
         border-top: 1px solid #333;
         transition: color var(--transition-time), border-color var(--transition-time);
      }

      .special-cards-container {
         margin-bottom: 0px;
         padding: 0 5px;
      }

      .special-card {
         background-color: var(--dark-card);
         border-radius: 10px;
         box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
         margin-bottom: 15px;
         overflow: hidden;
         transition: all 0.3s ease;
      }

      .special-card-header {
         padding: 15px 20px;
         background-color: rgba(231, 76, 60, 0.1);
         cursor: pointer;
         display: flex;
         justify-content: space-between;
         align-items: center;
         transition: background-color 0.2s ease;
      }

      .special-card-header:hover {
         background-color: rgba(231, 76, 60, 0.15);
      }

      .special-card-title-container {
         display: flex;
         align-items: center;
         gap: 10px;
         flex: 1;
         min-width: 0;
      }

      .special-card-icon {
         font-size: 20px;
         color: var(--primary-color);
         flex-shrink: 0;
      }

      .special-card-title {
         font-size: 18px;
         font-weight: 600;
         color: white;
         margin: 0;
         white-space: nowrap;
         overflow: hidden;
         text-overflow: ellipsis;
      }

      .special-card-tags {
         display: flex;
         gap: 6px;
         flex-wrap: wrap;
         margin-left: 10px;
      }

      .special-card-tag {
         padding: 3px 10px;
         border-radius: 12px;
         font-size: 11px;
         font-weight: 500;
         background-color: rgba(231, 76, 60, 0.2);
         color: var(--primary-color);
         white-space: nowrap;
      }

      .special-card-arrow {
         font-size: 16px;
         color: var(--primary-color);
         transition: transform 0.3s ease;
         flex-shrink: 0;
         margin-left: 10px;
      }

      .special-card.expanded .special-card-arrow {
         transform: rotate(180deg);
      }

      .special-card-content {
         max-height: 0;
         overflow: hidden;
         transition: max-height 0.3s ease, padding 0.3s ease;
      }

      .special-card.expanded .special-card-content {
         max-height: 500px;
         padding: 20px;
      }

      .special-card-items {
         display: flex;
         flex-direction: column;
         gap: 12px;
      }

      .special-card-item {
         padding: 12px;
         background-color: rgba(255, 255, 255, 0.05);
         border-radius: 8px;
         cursor: pointer;
         transition: all 0.2s ease;
         border-left: 3px solid var(--primary-color);
      }

      .special-card-item:hover {
         background-color: rgba(255, 255, 255, 0.1);
         transform: translateX(5px);
      }

      .special-card-item-title {
         font-size: 16px;
         font-weight: 500;
         color: white;
         margin-bottom: 5px;
      }

      .special-card-item-description {
         font-size: 13px;
         color: #b0b0b0;
         line-height: 1.4;
      }

      .search-overlay {
         position: fixed;
         top: 0;
         left: 0;
         width: 100%;
         height: 100%;
         background-color: rgba(0, 0, 0, 0.85);
         display: flex;
         align-items: center;
         justify-content: center;
         z-index: 1000;
         opacity: 0;
         visibility: hidden;
         transition: opacity 0.3s ease, visibility 0.3s ease;
      }

      .search-overlay.active {
         opacity: 1;
         visibility: visible;
      }

      .search-container {
         width: 90%;
         max-width: 500px;
         background-color: var(--dark-card);
         border-radius: 15px;
         padding: 25px;
         box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
      }

      .search-title {
         font-size: 20px;
         font-weight: 600;
         color: white;
         margin-bottom: 15px;
         text-align: center;
      }

      .search-input-wrapper {
         position: relative;
         margin-bottom: 15px;
      }

      .search-input {
         width: 100%;
         padding: 12px 15px;
         border: 2px solid #333;
         border-radius: 10px;
         background-color: #121212;
         color: white;
         font-size: 16px;
         outline: none;
         transition: border-color 0.3s ease;
      }

      .search-input:focus {
         border-color: var(--primary-color);
      }

      .search-input.error {
         border-color: #ff4444;
      }

      .search-options {
         display: flex;
         gap: 10px;
         justify-content: center;
      }

      .search-option {
         padding: 8px 20px;
         border: 2px solid #333;
         border-radius: 20px;
         background-color: transparent;
         color: white;
         font-size: 14px;
         cursor: pointer;
         transition: all 0.3s ease;
      }

      .search-option:hover {
         border-color: var(--primary-color);
         color: var(--primary-color);
      }

      .search-option.active {
         background-color: var(--primary-color);
         border-color: var(--primary-color);
         color: white;
      }

      .article-page {
         height: 100%;
         display: flex;
         flex-direction: column;
         overflow: hidden;
      }

      .article-header {
         background-color: var(--dark-card);
         padding: 20px;
         border-radius: 10px;
         margin-bottom: 15px;
         flex-shrink: 0;
      }

      .article-back-btn {
         display: inline-flex;
         align-items: center;
         gap: 8px;
         padding: 10px 20px;
         background-color: var(--primary-color);
         color: white;
         border: none;
         border-radius: 8px;
         font-size: 14px;
         cursor: pointer;
         transition: all 0.2s ease;
         margin-bottom: 15px;
      }

      .article-back-btn:hover {
         background-color: #c0392b;
         transform: translateX(-3px);
      }

      .article-title-display {
         font-size: 24px;
         font-weight: 700;
         color: white;
         margin-bottom: 10px;
         line-height: 1.3;
      }

      .article-meta-display {
         display: flex;
         flex-wrap: wrap;
         gap: 15px;
         font-size: 14px;
         color: #888;
      }

      .article-content-wrapper {
         flex: 1;
         min-height: 0;
         overflow-y: auto;
         background-color: var(--dark-card);
         border-radius: 10px;
         padding: 20px;
      }

      .article-content {
         color: white;
         line-height: 1.8;
         font-size: 16px;
      }

      .article-content h1,
      .article-content h2,
      .article-content h3 {
         margin-top: 25px;
         margin-bottom: 15px;
         color: white;
      }

      .article-content p {
         margin-bottom: 15px;
      }

      .article-content a {
         color: var(--primary-color);
         text-decoration: none;
      }

      .article-content a:hover {
         text-decoration: underline;
      }

      body.light-mode {
         background-color: var(--light-bg);
         color: #333;
      }

      body.light-mode .mobile-top-section,
      body.light-mode .mobile-card,
      body.light-mode .floating-menu,
      body.light-mode .special-card,
      body.light-mode .search-container,
      body.light-mode .article-header,
      body.light-mode .article-content-wrapper {
         background-color: white;
         box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
      }

      body.light-mode .mobile-top-card,
      body.light-mode .search-input {
         background-color: #f8f9fa;
      }

      body.light-mode .mobile-title,
      body.light-mode .card-title,
      body.light-mode .menu-item,
      body.light-mode .search-title,
      body.light-mode .search-input,
      body.light-mode .search-option,
      body.light-mode .article-title-display,
      body.light-mode .article-content,
      body.light-mode .special-card-title,
      body.light-mode .special-card-item-title {
         color: #333;
      }

      body.light-mode .card-description,
      body.light-mode .card-meta,
      body.light-mode .article-meta-display,
      body.light-mode .special-card-item-description {
         color: #666;
      }

      body.light-mode .menu-item,
      body.light-mode .card-meta {
         border-color: #e0e0e0;
      }

      body.light-mode .search-input,
      body.light-mode .search-option {
         border-color: #ddd;
      }

      body.light-mode .avatar {
         background-color: var(--light-primary);
      }

      body.light-mode .menu-btn {
         color: #333;
      }
   </style>
</head>

<body>
   <div class="container" id="mainContainer">
      <div class="mobile-layout" id="mobileLayout">
         <!-- 顶部区域 -->
         <div class="mobile-top-section collapsed" id="mobileTopSection">
            <div class="mobile-top-bar">
               <div class="avatar" id="avatar"></div>
               <div class="mobile-title-container" id="titleToggle">
                  <span class="mobile-title" id="mobileTitle">Ae1autumn</span>
               </div>
               <button class="menu-btn" id="menuBtn" aria-label="打开菜单" aria-expanded="false">
                  <i class="fas fa-bars"></i>
               </button>
            </div>
            <div class="mobile-top-card" id="mobileTopCard">
               I was only temporary to you
            </div>
         </div>

         <!-- 特殊卡片区域 -->
         <div class="special-cards-container" id="specialCardsContainer"></div>

         <!-- 文章列表区域 -->
         <div class="article-list-section" id="articleListSection">
            <div class="mobile-cards-container">
               <div class="mobile-cards-wrapper" id="mobileCardsWrapper"></div>
            </div>
         </div>
      </div>
   </div>

   <!-- 浮动菜单 -->
   <div class="floating-menu" id="floatingMenu" aria-hidden="true">
      <div class="menu-items" id="menuItems">
         <div class="menu-item" id="searchMenuItem">
            <i class="fas fa-search"></i> 搜索
         </div>
         <div class="menu-item" id="darkModeToggle">
            <i class="fas fa-moon"></i> <span id="themeToggleText">日间</span>
         </div>
      </div>
   </div>

   <!-- 搜索遮罩层 -->
   <div class="search-overlay" id="searchOverlay">
      <div class="search-container">
         <div class="search-title">搜索文章</div>
         <div class="search-input-wrapper">
            <input type="text" class="search-input" id="searchInput" placeholder="Enter确认,点击标题退出">
         </div>
         <div class="search-options" id="searchOptions">
            <button class="search-option active" data-type="title">标题</button>
            <button class="search-option" data-type="tag">标签</button>
            <button class="search-option" data-type="all">全部</button>
         </div>
      </div>
   </div>

   <script>
      // ==================== 博客数据 ====================
      const blogData = {
         articles: [
            { title: "文章1", description: "这是第一篇文章的描述", date: "2024-01-15", tags: ["技术", "前端"], content: "文章1的完整内容..." },
            { title: "文章2", description: "这是第二篇文章的描述", date: "2024-01-20", tags: ["生活"], content: "文章2的完整内容..." },
            { title: "文章3", description: "这是第三篇文章的描述", date: "2024-01-25", tags: ["技术", "后端"], content: "文章3的完整内容..." }
         ],
         specials: [
            {
               title: "特殊专栏",
               icon: "fas fa-star",
               tags: ["推荐"],
               items: [
                  { title: "特殊文章1", description: "特殊文章描述1", articleIndex: 0 },
                  { title: "特殊文章2", description: "特殊文章描述2", articleIndex: 1 }
               ]
            }
         ],
         menuLinks: [
            { title: "关于", url: "https://example.com/about" },
            { title: "友链", url: "https://example.com/links" }
         ]
      };

      const blogConfig = {
         themeColor: "#e74c3c"
      };

      // ==================== 状态管理 ====================
      const state = {
         currentView: 'home', // 'home' 或 'article'
         currentArticleIndex: null,
         isSearchMode: false,
         searchType: 'title',
         currentArticles: [],
         originalArticles: [],
         virtualScroll: null
      };

      // ==================== 工具函数 ====================
      function sortArticlesByDateDesc(articles) {
         return articles.sort((a, b) => new Date(b.date) - new Date(a.date));
      }

      function filterArticles(articles, keyword, searchType) {
         const lowerKeyword = keyword.toLowerCase();
         return articles.filter(article => {
            if (searchType === 'title') {
               return article.title.toLowerCase().includes(lowerKeyword);
            } else if (searchType === 'tag') {
               return article.tags && article.tags.some(tag => tag.toLowerCase().includes(lowerKeyword));
            } else {
               const titleMatch = article.title.toLowerCase().includes(lowerKeyword);
               const tagMatch = article.tags && article.tags.some(tag => tag.toLowerCase().includes(lowerKeyword));
               const descMatch = article.description && article.description.toLowerCase().includes(lowerKeyword);
               return titleMatch || tagMatch || descMatch;
            }
         });
      }

      function getCardColor(index, isDark) {
         const darkColors = [
            { bg: 'rgba(231, 76, 60, 0.1)', text: '#e74c3c' },
            { bg: 'rgba(52, 152, 219, 0.1)', text: '#3498db' },
            { bg: 'rgba(46, 204, 113, 0.1)', text: '#2ecc71' },
            { bg: 'rgba(241, 196, 15, 0.1)', text: '#f1c40f' },
            { bg: 'rgba(155, 89, 182, 0.1)', text: '#9b59b6' }
         ];
         
         const lightColors = [
            { bg: 'rgba(231, 76, 60, 0.08)', text: '#c0392b' },
            { bg: 'rgba(52, 152, 219, 0.08)', text: '#2980b9' },
            { bg: 'rgba(46, 204, 113, 0.08)', text: '#27ae60' },
            { bg: 'rgba(241, 196, 15, 0.08)', text: '#f39c12' },
            { bg: 'rgba(155, 89, 182, 0.08)', text: '#8e44ad' }
         ];
         
         const colors = isDark ? darkColors : lightColors;
         return colors[index % colors.length];
      }

      function updateCardsColorIndices() {
         const cards = document.querySelectorAll('.mobile-card');
         const isDark = !document.body.classList.contains('light-mode');
         
         cards.forEach((card, index) => {
            const color = getCardColor(index, isDark);
            const tags = card.querySelectorAll('.card-tag');
            tags.forEach(tag => {
               tag.style.backgroundColor = color.bg;
               tag.style.color = color.text;
            });
         });
      }

      function forceUpdateAllCardsColor() {
         updateCardsColorIndices();
      }

      // ==================== 主题切换 ====================
      let themeTransitionTimeout;

      function initTheme() {
         const savedTheme = localStorage.getItem('theme');
         if (savedTheme === 'light') {
            document.body.classList.add('light-mode');
            updateThemeToggleText();
         }
      }

      function toggleTheme() {
         document.body.classList.add('theme-transitioning');
         
         document.body.classList.toggle('light-mode');
         const isLight = document.body.classList.contains('light-mode');
         localStorage.setItem('theme', isLight ? 'light' : 'dark');
         
         updateThemeToggleText();
         
         if (themeTransitionTimeout) {
            clearTimeout(themeTransitionTimeout);
         }
         
         themeTransitionTimeout = setTimeout(() => {
            document.body.classList.remove('theme-transitioning');
            forceUpdateAllCardsColor();
         }, 300);
         
         setTimeout(() => {
            forceUpdateAllCardsColor();
         }, 50);
      }

      function updateThemeToggleText() {
         const toggleText = document.getElementById('themeToggleText');
         const isLight = document.body.classList.contains('light-mode');
         toggleText.textContent = isLight ? '夜间' : '日间';
      }

      // ==================== 渲染函数 ====================
      function renderArticles(articles, isSearchResult) {
         const wrapper = document.getElementById('mobileCardsWrapper');
         if (!wrapper) return;
         
         wrapper.innerHTML = '';
         
         if (articles.length === 0) {
            wrapper.innerHTML = '<div style="padding: 20px; text-align: center; color: #888;">没有找到文章</div>';
            return;
         }
         
         const isDark = !document.body.classList.contains('light-mode');
         
         articles.forEach((article, index) => {
            const card = document.createElement('div');
            card.className = 'mobile-card';
            card.dataset.index = blogData.articles.indexOf(article);
            
            const color = getCardColor(index, isDark);
            
            const tagsHTML = article.tags && article.tags.length > 0
               ? `<div class="card-tags">
                     ${article.tags.map(tag => `
                        <span class="card-tag" style="background-color: ${color.bg}; color: ${color.text};">
                           ${tag}
                        </span>
                     `).join('')}
                  </div>`
               : '';
            
            card.innerHTML = `
               ${tagsHTML}
               <h3 class="card-title">${article.title}</h3>
               <p class="card-description">${article.description || ''}</p>
               <div class="card-meta">
                  <span><i class="far fa-calendar"></i> ${article.date}</span>
               </div>
            `;
            
            card.addEventListener('click', () => {
               const articleIndex = parseInt(card.dataset.index);
               navigateToArticle(articleIndex);
            });
            
            wrapper.appendChild(card);
         });
      }

      function renderSpecialCards() {
         const container = document.getElementById('specialCardsContainer');
         if (!container) return;
         
         container.innerHTML = '';
         
         if (!blogData.specials || blogData.specials.length === 0) {
            container.style.display = 'none';
            return;
         }
         
         container.style.display = 'block';
         
         blogData.specials.forEach((special, specialIndex) => {
            const hasMultipleSpecials = blogData.specials.length > 1;
            const hasTitleOrTags = special.title || (special.tags && special.tags.length > 0);
            const shouldExpand = hasMultipleSpecials || hasTitleOrTags;
            
            const card = document.createElement('div');
            card.className = 'special-card';
            card.id = specialIndex === 0 ? 'specialCard' : `specialCard${specialIndex}`;
            
            if (!shouldExpand && special.items && special.items.length === 1) {
               card.classList.add('expanded');
            }
            
            const tagsHTML = special.tags && special.tags.length > 0
               ? `<div class="special-card-tags">
                     ${special.tags.map(tag => `<span class="special-card-tag">${tag}</span>`).join('')}
                  </div>`
               : '';
            
            const headerHTML = shouldExpand
               ? `<div class="special-card-header">
                     <div class="special-card-title-container">
                        ${special.icon ? `<i class="${special.icon} special-card-icon"></i>` : ''}
                        ${special.title ? `<h3 class="special-card-title">${special.title}</h3>` : ''}
                        ${tagsHTML}
                     </div>
                     <i class="fas fa-chevron-down special-card-arrow"></i>
                  </div>`
               : '';
            
            const itemsHTML = special.items && special.items.length > 0
               ? special.items.map(item => `
                     <div class="special-card-item" data-article-index="${item.articleIndex}">
                        <div class="special-card-item-title">${item.title}</div>
                        ${item.description ? `<div class="special-card-item-description">${item.description}</div>` : ''}
                     </div>
                  `).join('')
               : '';
            
            card.innerHTML = `
               ${headerHTML}
               <div class="special-card-content">
                  <div class="special-card-items">
                     ${itemsHTML}
                  </div>
               </div>
            `;
            
            container.appendChild(card);
            
            const items = card.querySelectorAll('.special-card-item');
            items.forEach(item => {
               item.addEventListener('click', (e) => {
                  e.stopPropagation();
                  const articleIndex = parseInt(item.dataset.articleIndex);
                  navigateToArticle(articleIndex);
               });
            });
         });
      }

      function renderDynamicMenuItems() {
         const menuContainer = document.getElementById('menuItems');
         if (!menuContainer) return;
         
         if (blogData.menuLinks && blogData.menuLinks.length > 0) {
            blogData.menuLinks.forEach(link => {
               const menuItem = document.createElement('a');
               menuItem.className = 'menu-item';
               menuItem.href = link.url;
               menuItem.target = '_blank';
               menuItem.rel = 'noopener noreferrer';
               menuItem.innerHTML = `<i class="fas fa-link"></i> ${link.title}`;
               menuContainer.appendChild(menuItem);
            });
         }
      }

      // ==================== 页面导航 ====================
      function navigateToArticle(articleIndex) {
         state.currentView = 'article';
         state.currentArticleIndex = articleIndex;
         
         // 保存当前主视图的 HTML,以便返回时恢复
         const mobileLayout = document.getElementById('mobileLayout');
         if (mobileLayout) {
            state.savedHomeHTML = mobileLayout.innerHTML;
         }
         
         renderArticlePage(articleIndex);
         
         history.pushState({ view: 'article', articleIndex }, '', `#article-${articleIndex}`);
      }

      function renderArticlePage(articleIndex) {
         const article = blogData.articles[articleIndex];
         if (!article) return;
         
         const container = document.getElementById('mainContainer');
         container.innerHTML = `
            <div class="article-page">
               <div class="article-header">
                  <button class="article-back-btn" id="articleBackBtn">
                     <i class="fas fa-arrow-left"></i> 返回
                  </button>
                  <h1 class="article-title-display">${article.title}</h1>
                  <div class="article-meta-display">
                     <span><i class="far fa-calendar"></i> ${article.date}</span>
                     ${article.tags ? `<span><i class="fas fa-tags"></i> ${article.tags.join(', ')}</span>` : ''}
                  </div>
               </div>
               <div class="article-content-wrapper">
                  <div class="article-content">
                     ${article.content}
                  </div>
               </div>
            </div>
         `;
         
         setupArticlePage();
      }

      function setupArticlePage() {
         const backBtn = document.getElementById('articleBackBtn');
         if (backBtn) {
            backBtn.addEventListener('click', (e) => {
               e.preventDefault();
               navigateToHome();
            });
         }
      }

      function navigateToHome() {
         state.currentView = 'home';
         state.currentArticleIndex = null;
         
         // 恢复首页视图
         const container = document.getElementById('mainContainer');
         if (state.savedHomeHTML) {
            container.innerHTML = `<div class="mobile-layout" id="mobileLayout">${state.savedHomeHTML}</div>`;
         } else {
            // 如果没有保存的 HTML,重新渲染整个首页
            renderHomePage();
         }
         
         // 重新绑定事件
         bindEvents();
         bindMenuEvents();
         
         // 更新 URL
         history.pushState({ view: 'home' }, '', '#');
      }

      function renderHomePage() {
         const container = document.getElementById('mainContainer');
         container.innerHTML = `
            <div class="mobile-layout" id="mobileLayout">
               <div class="mobile-top-section collapsed" id="mobileTopSection">
                  <div class="mobile-top-bar">
                     <div class="avatar" id="avatar"></div>
                     <div class="mobile-title-container" id="titleToggle">
                        <span class="mobile-title" id="mobileTitle">Ae1autumn</span>
                     </div>
                     <button class="menu-btn" id="menuBtn" aria-label="打开菜单" aria-expanded="false">
                        <i class="fas fa-bars"></i>
                     </button>
                  </div>
                  <div class="mobile-top-card" id="mobileTopCard">
                     I was only temporary to you
                  </div>
               </div>
               <div class="special-cards-container" id="specialCardsContainer"></div>
               <div class="article-list-section" id="articleListSection">
                  <div class="mobile-cards-container">
                     <div class="mobile-cards-wrapper" id="mobileCardsWrapper"></div>
                  </div>
               </div>
            </div>
         `;
         
         // 重新渲染内容
         const sortedArticles = sortArticlesByDateDesc([...blogData.articles]);
         renderArticles(sortedArticles, false);
         renderSpecialCards();
         renderDynamicMenuItems();
         
         // 延迟更新卡片颜色
         setTimeout(() => {
            updateCardsColorIndices();
            if (document.body.classList.contains('light-mode')) {
               setTimeout(forceUpdateAllCardsColor, 50);
            }
         }, 100);
      }

      // ==================== 浏览器历史管理 ====================
      window.addEventListener('popstate', (e) => {
         if (e.state) {
            if (e.state.view === 'article') {
               renderArticlePage(e.state.articleIndex);
            } else {
               navigateToHome();
            }
         } else {
            navigateToHome();
         }
      });

      // ==================== 搜索功能 ====================
      function enterSearchMode(filteredArticles) {
         state.isSearchMode = true;
         state.currentArticles = filteredArticles;
         const sortedArticles = sortArticlesByDateDesc([...filteredArticles]);
         renderArticles(sortedArticles, true);
         closeSearchOverlay();
      }

      function exitSearchMode() {
         state.isSearchMode = false;
         state.currentArticles = [];
         const originalSorted = sortArticlesByDateDesc([...blogData.articles]);
         renderArticles(originalSorted, false);
         closeSearchOverlay();
      }

      function performSearch() {
         const input = document.getElementById('searchInput');
         const keyword = input.value.trim();
         const searchType = state.searchType;
         
         if (!keyword) {
            showSearchError('未输入');
            return;
         }
         
         let filtered = filterArticles(blogData.articles, keyword, searchType);
         
         if (filtered.length === 0) {
            showSearchError(`没有符合"${keyword}"的文章`);
            return;
         }
         
         enterSearchMode(filtered);
      }

      function showSearchError(message) {
         const input = document.getElementById('searchInput');
         input.value = '';
         input.placeholder = message;
         input.classList.add('error');
         
         const restoreOnNextInput = () => {
            input.classList.remove('error');
            input.placeholder = 'Enter确认,点击标题退出';
            input.removeEventListener('input', restoreOnNextInput);
         };
         
         input.addEventListener('input', restoreOnNextInput);
      }

      // ==================== UI 交互控制 ====================
      function openSearchOverlay() {
         const overlay = document.getElementById('searchOverlay');
         const input = document.getElementById('searchInput');
         
         input.value = '';
         input.placeholder = 'Enter确认,点击标题退出';
         input.classList.remove('error');
         
         overlay.classList.add('active');
         input.focus();
      }

      function closeSearchOverlay() {
         document.getElementById('searchOverlay').classList.remove('active');
      }

      function openFloatingMenu() {
         const menu = document.getElementById('floatingMenu');
         menu.classList.remove('closing');
         menu.classList.add('active');
         document.getElementById('menuBtn').setAttribute('aria-expanded', 'true');
         menu.setAttribute('aria-hidden', 'false');
      }

      function closeFloatingMenu() {
         const menu = document.getElementById('floatingMenu');
         if (menu.classList.contains('active')) {
            menu.classList.add('closing');
            menu.classList.remove('active');
            
            setTimeout(() => {
               menu.classList.remove('closing');
               menu.setAttribute('aria-hidden', 'true');
               document.getElementById('menuBtn').setAttribute('aria-expanded', 'false');
            }, 250);
         }
      }

      function toggleFloatingMenu() {
         const menu = document.getElementById('floatingMenu');
         
         if (menu.classList.contains('active') || menu.classList.contains('closing')) {
            closeFloatingMenu();
         } else {
            openFloatingMenu();
         }
      }

      // ==================== 事件绑定 ====================
      function bindEvents() {
         // 搜索菜单项点击事件
         const searchMenuItem = document.getElementById('searchMenuItem');
         if (searchMenuItem) {
            searchMenuItem.addEventListener('click', () => {
               openSearchOverlay();
               closeFloatingMenu();
            });
         }
         
         // 菜单按钮点击事件
         const menuBtn = document.getElementById('menuBtn');
         if (menuBtn) {
            menuBtn.addEventListener('click', (e) => {
               e.stopPropagation();
               toggleFloatingMenu();
            });
         }
         
         // 搜索输入框事件
         const searchInput = document.getElementById('searchInput');
         if (searchInput) {
            searchInput.addEventListener('keypress', (e) => {
               if (e.key === 'Enter') performSearch();
            });
         }
         
         // 键盘事件
         document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
               const overlay = document.getElementById('searchOverlay');
               if (overlay && overlay.classList.contains('active')) {
                  closeSearchOverlay();
               }
               const floatingMenu = document.getElementById('floatingMenu');
               if (floatingMenu && floatingMenu.classList.contains('active')) {
                  closeFloatingMenu();
               }
            }
         });
         
         // 搜索选项点击事件
         document.querySelectorAll('#searchOptions .search-option').forEach(btn => {
            btn.addEventListener('click', (e) => {
               e.preventDefault();
               document.querySelectorAll('#searchOptions .search-option').forEach(b => b.classList.remove('active'));
               btn.classList.add('active');
               state.searchType = btn.dataset.type;
               
               setTimeout(() => {
                  const input = document.getElementById('searchInput');
                  if (input) input.focus();
               }, 10);
            });
         });
         
         // 搜索遮罩点击事件
         const searchOverlay = document.getElementById('searchOverlay');
         if (searchOverlay) {
            searchOverlay.addEventListener('click', (e) => {
               if (e.target === e.currentTarget) closeSearchOverlay();
            });
         }
         
         // 全局点击事件
         document.addEventListener('click', (e) => {
            const menu = document.getElementById('floatingMenu');
            const btn = document.getElementById('menuBtn');
            
            if (menu && btn && !menu.contains(e.target) && !btn.contains(e.target) && 
                (menu.classList.contains('active') || menu.classList.contains('closing'))) {
               closeFloatingMenu();
            }
         });
         
         const floatingMenu = document.getElementById('floatingMenu');
         if (floatingMenu) {
            floatingMenu.addEventListener('click', (e) => {
               e.stopPropagation();
            });
         }
         
         // 主题切换事件
         const darkModeToggle = document.getElementById('darkModeToggle');
         if (darkModeToggle) {
            darkModeToggle.addEventListener('click', toggleTheme);
         }
         
         // 标题点击事件
         const titleToggle = document.getElementById('titleToggle');
         if (titleToggle) {
            titleToggle.addEventListener('click', () => {
               if (state.isSearchMode) {
                  exitSearchMode();
               } else {
                  const topSection = document.getElementById('mobileTopSection');
                  if (topSection) {
                     topSection.classList.toggle('expanded');
                     topSection.classList.toggle('collapsed');
                  }
               }
            });
         }
         
         // 特殊卡片点击事件
         const specialCardHeader = document.querySelector('.special-card-header');
         if (specialCardHeader) {
            specialCardHeader.addEventListener('click', (e) => {
               e.preventDefault();
               e.stopPropagation();
               
               const shouldToggle = blogData.specials.length > 1 || 
                   (blogData.specials.length === 1 && 
                    (blogData.specials[0].title || 
                     (blogData.specials[0].tags && blogData.specials[0].tags.length > 0)));
               
               if (shouldToggle) {
                  const card = document.getElementById('specialCard');
                  if (card) {
                     card.classList.toggle('expanded');
                     card.setAttribute('aria-expanded', card.classList.contains('expanded'));
                  }
               }
            });
         }
      }

      function bindMenuEvents() {
         const menuContainer = document.getElementById('menuItems');
         if (!menuContainer) return;
         
         const menuItemElements = menuContainer.querySelectorAll('.menu-item');
         
         menuItemElements.forEach(item => {
            if (item.id !== 'searchMenuItem' && item.id !== 'darkModeToggle') {
               item.addEventListener('click', () => {
                  closeFloatingMenu();
               });
            }
         });
      }

      // ==================== 页面初始化 ====================
      document.addEventListener('DOMContentLoaded', () => {
         // 初始化主题
         initTheme();
         
         // 初始化状态
         state.originalArticles = [...blogData.articles];
         state.currentArticles = blogData.articles;
         
         // 渲染内容
         const sortedArticles = sortArticlesByDateDesc([...blogData.articles]);
         renderArticles(sortedArticles, false);
         renderSpecialCards();
         
         // 渲染动态菜单项
         renderDynamicMenuItems();
         
         // 绑定事件
         bindEvents();
         bindMenuEvents();
         
         // 设置主题颜色
         if (blogConfig.themeColor) {
            document.documentElement.style.setProperty('--primary-color', blogConfig.themeColor);
         }
         
         // 延迟更新卡片颜色,确保DOM已完全渲染
         setTimeout(() => {
            updateCardsColorIndices();
            if (document.body.classList.contains('light-mode')) {
               setTimeout(forceUpdateAllCardsColor, 50);
            }
         }, 100);
         
         // 处理初始 URL 状态
         if (window.location.hash) {
            const match = window.location.hash.match(/#article-(\d+)/);
            if (match) {
               const articleIndex = parseInt(match[1]);
               navigateToArticle(articleIndex);
            }
         } else {
            history.replaceState({ view: 'home' }, '', '#');
         }
      });

      // 页面卸载时清理
      window.addEventListener('beforeunload', () => {
         if (state.virtualScroll) {
            state.virtualScroll.destroy();
         }
         if (themeTransitionTimeout) {
            clearTimeout(themeTransitionTimeout);
         }
      });
   </script>
</body>

</html>